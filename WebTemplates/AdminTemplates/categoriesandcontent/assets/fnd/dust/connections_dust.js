(function(){dust.register("connections.dust",body_0);function body_0(chk,ctx){return chk.write("<script type=\"text/javascript\">var ActivateAccordion = function($clickedObject) {var $myAccordion = $clickedObject.closest(\".accordion\");var $currActive = $myAccordion.find(\"div.content.active\");$currActive.toggleClass(\"active\");$dd = $clickedObject.closest(\"dd\");$div = $dd.find(\"div.content\");if($currActive.get(0) != $div.get(0)){/* Only toggle active back active, if the click was different */$div.toggleClass(\"active\");}};var UpdateConnectionThisSide = function(connectionID) {tOP.ExecuteOperationWithForm(\"UpdateConnectionThisSideCategories\", { \"ConnectionID\": connectionID});};var SynchronizeConnectionCategories = function(connectionID) {tOP.ExecuteOperationWithForm(\"SynchronizeConnectionCategories\", { \"ConnectionID\": connectionID});};var OpenAddConnectionForm = function() {$(\"#OPInitiateIntegrationConnectionModal\").foundation('reveal', 'open');};var DeleteConnection = function(connectionID) {tOP.ExecuteOperationWithForm(\"DeleteConnection\", { \"ConnectionID\": connectionID});};var FinalizeConnection = function(connectionID) {tOP.ExecuteOperationWithForm(\"FinalizeConnectionAfterGroupAuthorization\", { \"ConnectionID\": connectionID });};var SetCategoryLinksFromTreeSelections = function(connectionID) {var leftNodes = $(\"#LeftSideConnectionTree\" + connectionID).dynatree('getSelectedNodes');var leftIDs = $.map(leftNodes, function(node) {return node.data.ID;});var rightNodes = $(\"#RightSideConnectionTree\" + connectionID).dynatree('getSelectedNodes');var rightIDs = $.map(rightNodes, function(node) {return node.data.ID;});if(leftIDs.length == 0 || rightIDs.length == 0)return;var addLink = {SourceCategoryID: leftIDs[0],TargetCategoryID: rightIDs[0],LinkingType: \"ONE2ONE\"};var conn = GetConnectionByID(connectionID);var existingLinks = $.map(conn.CategoryLinks, function(catLink) {return {SourceCategoryID: catLink.SourceCategoryID,TargetCategoryID: catLink.TargetCategoryID,LinkingType: catLink.LinkingType};});existingLinks.push(addLink);var parameterObj = {ConnectionID: connectionID,LinkItems: existingLinks};tOP.ExecuteOperationWithAjax(\"TheBall.Interface.SetCategoryLinkingForConnection\", parameterObj);};var PopulateTreeConnectors = function(connectionID) {var conn = GetConnectionByID(connectionID);$(\"#LeftSideConnectionTree\" + connectionID).dynatree({onActivate: function(node) {},persist: false,children: conn.UI_ThisSideCategories,checkbox: true,selectMode: 1});$(\"#RightSideConnectionTree\" + connectionID).dynatree({onActivate: function(node) {},persist: false,children: conn.UI_OtherSideCategories,checkbox: true,selectMode: 1});};</script>").section(ctx.get("Connections"),ctx,{"block":body_1},null).write("<button onclick=\"OpenAddConnectionForm()\">Add Connection</button><script type=\"text/javascript\">$(\".connectionAccordion\").click(function() {ActivateAccordion($(this));return false;});</script><script>var initFormAddCategoryLink = function() {$(\"#AddCategoryLink\").submit(function() {$(\"#AddCategoryLinkModal\").foundation('reveal', 'close');});}</script><div id=\"").reference(ctx.get("form_id"),ctx,"h").write("Modal\" class=\"reveal-modal\" data-reveal><h2>").reference(ctx.get("modal_header"),ctx,"h").write("</h2>").partial("form_begin.dust",ctx,null);}function body_1(chk,ctx){return chk.write("<dl class=\"accordion\" data-accordion>").section(ctx.get("CollectionContent"),ctx,{"block":body_2},null).write("</dl>");}function body_2(chk,ctx){return chk.write("<dd id=\"dd").reference(ctx.get("ID"),ctx,"h").write("\"><a href=\"#\" class=\"connectionAccordion\">").reference(ctx.get("Description"),ctx,"h").write("</a><div id=\"conAcc").reference(ctx.get("ID"),ctx,"h").write("\" class=\"content\">").notexists(ctx.get("OtherSideConnectionID"),ctx,{"else":body_3,"block":body_6},null).write("<div id=\"LeftSideConnectionTree").reference(ctx.get("ID"),ctx,"h").write("\" style=\"width: 50%;display: inline-block\"></div><div id=\"RightSideConnectionTree").reference(ctx.get("ID"),ctx,"h").write("\" style=\"width: 50%;display: inline-block\"></div><button onclick=\"DeleteConnection('").reference(ctx.get("ID"),ctx,"h").write("')\">Delete connection</button></div></dd>");}function body_3(chk,ctx){return chk.write("<button onclick=\"SynchronizeConnectionCategories('").reference(ctx.get("ID"),ctx,"h").write("')\">Synchronize Categories</button>").exists(ctx.getPath(false,["ThisSideCategories","length"]),ctx,{"block":body_4},null);}function body_4(chk,ctx){return chk.write("<script type=\"text/javascript\">PopulateTreeConnectors('").reference(ctx.get("ID"),ctx,"h").write("');</script><button onclick=\"SetCategoryLinksFromTreeSelections('").reference(ctx.get("ID"),ctx,"h").write("')\">Set Category Links</button><table><tr><th>Linking Info</th></tr>").section(ctx.get("CategoryLinks"),ctx,{"block":body_5},null).write("</table>");}function body_5(chk,ctx){return chk.write("<tr><td>").reference(ctx.get("SourceCategoryID"),ctx,"h").write(" - ").reference(ctx.get("TargetCategoryID"),ctx,"h").write(" - ").reference(ctx.get("LinkingType"),ctx,"h").write("</td></tr>");}function body_6(chk,ctx){return chk.write("<button onclick=\"FinalizeConnection('").reference(ctx.get("ID"),ctx,"h").write("')\">Finalize connection</button>");}return body_0;})();